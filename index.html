<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Temporizador con JavaScript - By Parzibyte</title>
</head>

<body>
	<h2 id="tiempoRestante"></h2>
	<button id="btnIniciar">Iniciar</button>
	<button id="btnPausar">Pausar</button>
	<button id="btnDetener">Detener</button>
	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const $tiempoRestante = document.querySelector("#tiempoRestante"),
				$btnIniciar = document.querySelector("#btnIniciar"),
				$btnPausar = document.querySelector("#btnPausar"),
				$btnDetener = document.querySelector("#btnDetener");
			let idInterval = null, diferenciaTemporal = 0,
				fechaFuturo = null;
			const iniciarTemporizador = (minutos, segundos) => {
				if (fechaFuturo) {
					fechaFuturo = new Date(new Date().getTime() + diferenciaTemporal);
					console.log("Reanudar con diferencia de " + diferenciaTemporal);
					diferenciaTemporal = 0;
				} else {
					console.log("Iniciar");
					const milisegundos = (segundos + (minutos * 60)) * 1000;
					fechaFuturo = new Date(new Date().getTime() + milisegundos);
				}
				clearInterval(idInterval);
				idInterval = setInterval(() => {
					const tiempoRestante = fechaFuturo.getTime() - new Date().getTime();
					if (tiempoRestante <= 0) {
						console.log("Tiempo terminado");
						clearInterval(idInterval);
					} else {
						$tiempoRestante.textContent = milisegundosAMinutosYSegundos(tiempoRestante);
					}
				}, 50);
			};

			const pausarTemporizador = () => {
				diferenciaTemporal = fechaFuturo.getTime() - new Date().getTime();
				clearInterval(idInterval);
			};

			const detenerTemporizador = () => {
				clearInterval(idInterval);
				fechaFuturo = null;
				diferenciaTemporal = 0;
			};

			const agregarCeroSiEsNecesario = valor => {
				if (valor < 10) {
					return "0" + valor;
				} else {
					return "" + valor;
				}
			}
			const milisegundosAMinutosYSegundos = (milisegundos) => {
				const minutos = parseInt(milisegundos / 1000 / 60);
				milisegundos -= minutos * 60 * 1000;
				segundos = (milisegundos / 1000);
				return `${agregarCeroSiEsNecesario(minutos)}:${agregarCeroSiEsNecesario(segundos.toFixed(1))}`;
			};


			$btnIniciar.onclick = () => {
				iniciarTemporizador(0, 30);
			};
			$btnPausar.onclick = pausarTemporizador;
			$btnDetener.onclick = detenerTemporizador;
		});
	</script>
</body>

</html>